# 磁盘知识体系结构图

<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\磁盘知识体系结构.png" alt="磁盘知识体系结构" style="zoom:75%;" />


# 第一层次

* SSD
```
1.写入寿命有限
2.数据难以恢复
```
#### 企业级SAS硬盘(默认):
    * 企业里常见的SAS硬盘是15000转/分(这里就是主轴的转数),一般选6*300G，6*600G，`满足容量的基础上尽量保持4块磁盘以上`


#### 企业级SATA硬盘:
    * 7200-10000转/分，优点是经济实惠，容量大。
    * 常用于数据量少，数据不需要给用户提供服务;用于备份。

#### 磁盘选购小结
    ```
    1)、线上的业务，用SAS磁盘。
    2)、线下的业务，用SATA磁盘。
    3)、线上高并发、小容量的业务，SSD磁盘。
    4)、成本控制思想:根据数据的访问热度，智能分析分层存储。SATA+SSD
    ```

#### 企业案例一:
* 不要用SATA磁盘来做在线高并发服务的数据存储或数据库业务，这是血的教训。

```
某公司采用SATA做数据库的存储盘，结果导致数据库连续宕机一个月。5台SATA盘RAID5。

解决:
    重新买5台，把磁盘从SATA(RAID5)换成SAS(RAID10)。6个月内没事。
问题所在:
    1)、数据库集群，主库选择用SAS Raid10，从库SAS Raid0。
    2)、当时数据库使用的引擎是MyISAM引擎(改引擎是表锁，不适合高并发访问)，改成Innodb引擎(行锁，顾名思义更新数据只所一行)。
    !!!主数据库只能写，从数据库只能读。
```

#### 淘宝网CDN缓存对象分级存储策略案例
* 提出问题:
```
在存储数据中，18KB以下的对象数据占总数量的80%，而其存储量占总量不到40%;同时，80%经常被访问的对象所占用的存储空间不到总量的20%。
```
* 分析问题:
```
以上的问题意味着"热点数据"(即访问频次高的内容)需要更快的性能，而占的空间并不大，而"冷数据"(访问频次低的内容)所需存储量很大，对性能要求不需要高。
```

* 解决问题:
```
因此，服务器引入分层存储机制，单台服务器(实际会多台)的磁盘可由一块80GB的SSD磁盘和两块500GB的SATA盘组成。然后把"热数据"存放在SSD盘上，"冷数据"存放在SATA盘上，冷热数据可以动态调度，从而兼顾性能、容量与成本。
!!!另:分层存储调度软件由淘宝开发。
```



## 磁盘核心知识及数据读写原理
#### 磁盘相关名词说明
英文		|	汉语
------------|:------------:
Disk		|     磁盘
Head		|   磁头
Sector		  |   扇区
Track		  |   磁道
Cylinder	|	柱面
Units		|	单元块(一个柱面的大小)
Block		|	数据块
Inode		|	索引节点

#### 磁盘示意图
* <img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\磁盘盘片示意图.png" alt="磁盘盘片示意图" style="zoom:75%;" />
##### 磁道
* 磁盘上相同圆心的不同半径的同心圆轨迹，`300~1024`个磁道。
* 由外到内依次从0开始递增

##### 柱面
* 不同盘面上的半径相同的磁道组成的。

##### 扇区
* 磁道上的一段圆弧。
* 每个扇区大小为512字节。
* 主要部分是标识符。

##### 记忆要点(磁道柱面扇区)
```
1)、一块磁盘有2-14个盘片，每个盘片有两个面，没有面对应一个读写磁头，用磁头号来区分盘面，即盘面数就是磁头数，盘片数*2=磁头数（盘面数）
2)、不同盘面的磁道被划分为多个扇形区域，每个区域就是一个扇区(Sector)。
3)、同一个盘面，以盘片中心为圆心，每个不同半径的圆形轨迹就是一个磁道(Track)。
4)、不同盘面相同半径的磁道组成一个圆柱面就是柱面(Cylinder)。
5)、一个柱面包含多个磁道(这些磁道的半径相同)，一个磁道包含多个扇区。
6)、数据信息记录可表示为:某磁头，某磁道（柱面），某扇区。

```
##### 磁盘容量计算
* ==磁盘容量== =`512字节`* `每磁道扇区数` * `磁道数` * `磁头数`

#### 磁盘的读写流程
* 按柱面来读写
* <img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\磁盘读写原理图.png" alt="磁盘读写原理图" style="zoom:75%;" />

## 命令
##### 查看磁盘及对应的分区
* `fdisk -l`
##### 计算磁盘容量
* `echo 512*63*2610*255/1000000000|bc`  bc是计算的意思




<br />
<br />

# 第二层次
## RAID
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\RAID的介绍.png" alt="磁盘读写原理图" style="zoom:75%;" />

* RAID就是磁盘阵列
#### 生产环境中常用的raid级别: ` Raid 0` `Raid 1` `Raid 5` `Raid 10`

##### 四种常用raid级别的优缺点：
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\4种raid的优缺点.png" alt="4种raid的优缺点" style="zoom:75%;" />

##### 七个raid的简单定义
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\7个raid的简单定义.png" alt="7个raid的简单定义" style="zoom:75%;" />

### RAID分为两类:
#### Ⅰ、==软RAID==：系统层面实现的，性能差。
#### Ⅱ、==硬RAID==：硬件层面实现的，性能好。
*  **==主板板载RAID==：功能弱，只支持`Raid 0`和`Raid 1`**
* **==独立RAID卡==：功能强，支持`Raid 0`、`Raid 1`、`Raid 5`、`Raid 10`。**



<br />
<br />

## LVM（Logic Volume Management）逻辑卷管理
```
它的最大用途是可以【灵活的管理磁盘的容量】，让磁盘分区可以随意放大或缩小，便于更好的应用磁盘的剩余空间，如果过于强调性能与备份，那么还是应该使用RAID功能，而不是LVM。
```
##### 不需要的理由:
* **LVM是软件层面实现的，性能太低，性能降低5-10%。**
* **买服务器插满磁盘，分区规划好，永远都不需要LVM。**



#### RAID和LVM的区别:
* **==LVM==**：灵活的管理磁盘，有一定的冗余和性能，但是很弱。
* **==RAID==**：更侧重性能和数据安全。

#### RAID最直接的好处:
```
1)、提升数据安全性。
2)、提升数据读写性能。
3)、提供更大的单一逻辑磁盘数据容量存储。
```

<br />
<br />

## 常用RAID细说
### RAID 0
##### 技术图:
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\RAID0的技术图.png" alt="RAID0的技术图" style="zoom:75%;" />

##### 优缺点:
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\RAID0的特点.png" alt="RAID0的特点" style="zoom:75%;" />

* 可以为一块盘。

##### 生产应用场景:
```
1)、负载均衡集群下面的多个相同RS节点服务器。
2)、分布式文件存储下面的主节点或CHUNK SERVER。
3)、MySQL主从复制的多个Slave服务器。
4)、对性能要求很高，对冗余要求很低的相关业务。
```

<br />

### RAID 1
```
 又名镜像，它的宗旨是最大限度的保证用户数据的可用性和可修复性。RAID 1的操作方式是把用户写入一个磁盘的数据百分之百地自动复制到另外一个磁盘上，从而实现存储双份的数据。
```

##### 技术图:
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\RAID1的技术图.png" alt="RAID1的技术图" style="zoom:75%;" />

##### 优缺点:
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\RAID1的特点.png" alt="RAID1的特点" style="zoom:75%;" />

* !!! 只能两块盘，大小可以不一致，以小容量为准。

<br />

### RAID 5
``RAID 5是一种存储性能、数据安全和存储成本兼顾的存储解决方案。``

```
RAID 5需要三块或以上的物理磁盘，可以提供热备盘实现故障的恢复;
采用【奇偶校验】，可靠性强，且只有同时损坏两块硬盘时数据才会完全损坏，只损坏一块硬盘时(不论有多少块盘)，系统会根据存储的奇偶校验位重建数据，临时提供服务;此时如果有热备盘，系统还会自动在热备盘上重建故障磁盘上的数据。
```
<br />
##### 技术图:
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\RAID5的技术图.png" alt="RAID5的技术图" style="zoom:75%;" />

* 以4块盘为例，每次写入数据，先在`前三块盘`上写入，最后一块盘上写入`前三块盘上数据的奇偶校验位`,后面再次写入的时候，在倒数第二块盘上写入`奇偶校验位`，其它三块盘写入数据。后面依次类推。

##### 优缺点:
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\RAID5的特点.png" alt="RAID5的特点" style="zoom:75%;" />

##### 3块盘优缺点详细:
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\RAID5的特点详细.png" alt="RAID5的特点详细" style="zoom:75%;" />


<br />

### RAID 10、01
##### RAID 10
```
RAID 10是先将四块硬盘在纵向上分别两两做镜像，镜像后再在横向上做皮带。即然1后0.
```
##### RAID 01
```
RAID 01是先将四块硬盘中横向上两两做皮带，然后纵向上做镜像。即先0后1
```
==!!! RAID 10和RAID 01在读写性能上没有太大的差别，从发生故障的概率上看，RAID 01是远大于RAID 10的。==

##### 优缺点:
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\RAID10的特点.png" alt="RAID10的特点" style="zoom:75%;" />


#### 常用RAID对比图
<img src="C:\Users\31650\Desktop\Python note\Oldboy\截图内容\常用RAID对比图.png" alt="常用RAID对比图" style="zoom:75%;" />


#### DELL R710 使用6块盘实践RAID制作结论
* ==Raid 0== 支持1块盘到多块盘，容量是所有盘之和。
* ==Raid 1== 只支持2块盘，容量损失一块盘。
* ==Raid 5== 最少三块盘，不管硬盘数量多少，只损失一块盘容量。
* ==Raid 6== 最少4块盘，5块盘也可以，损失2块盘，不管硬盘多少，只损失两块盘容量。
* ==Raid 10== 最少4块盘，必须偶数硬盘，不管硬盘多少，都损失一半容量，不支持虚拟磁盘。
 

